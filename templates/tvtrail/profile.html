{% extends 'tvtrail/base.html' %}
{% load staticfiles %}
{% block title %}
    {{ selecteduser.username }} Profile
{% endblock %}

{% block body_block %}
    <h3>{{selecteduser.username}}</h3>
    <h2>{{userprofile.first_name}} {{userprofile.last_name}}</h2>
    {% if userprofile.picture %}
        <img src="{{ MEDIA_URL }}{{ userprofile.picture }}"
            width="300"
            height="300"
            alt="{{selecteduser.username}}" />
        <br/>
    {% else %}
        <img src="{% static "images/RandomUserImage.jpg" %}" 
        alt="Profile Picture" 
        width="300"
        height="300"/>
        <br/>
    {% endif %}
    <div>
        <h3>Followed TV Shows:</h3>
            {% for series in userprofile.watchlist.all %}
                <a href="{% url 'show_tvseries' series.show_slug %}"><h2>{{ series.show_name }}</h2></a> <br/>
                Total episodes: {{ total_episodes_list|get_item:series.show_name }}<br/>
                Watched episodes: {{ watch_episodes_list|get_item:series.show_name }}<br/>
                {% if selected_user == current_user %}
                    {% if show_next_ep_season|get_item:series != None %}
                        Next episode to watch: <br/>
                        S{{ show_next_ep_season|get_item:series }} E{{ show_next_ep_num|get_item:series }}<br/>
                        {{ show_next_episode_title|get_item:series }} <br/>
                    {% else %}
                        All episodes watched.
                    {% endif %}
                {% endif %}
                {% if completion_percentage|get_item:series.show_name != None %}
                    <!-- Completion: {{ completion_percentage|get_item:series.show_name }}% <br/> -->
                    <div class="progress">
                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:{{ completion_percentage|get_item:series.show_name }}%">
                            {{ completion_percentage|get_item:series.show_name }}% Complete
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
            <br/>
    </div>

    <div>
        
        {% if selected_user == current_user %}
            <h3>
                Stats:
            </h3>
            Total Series Followed: {{ current_userprofile.watchlist.all.count }} <br/>
            Total Time Spent Watching: {{ total_time_spent_watching }} mins.<br/>
            Time Left for Completion: {{ total_time_for_completion }} mins.<br/>
        {% endif %}
    </div>

    <div>
        <h3>
            Total Completion:
            <!-- Total Completion: {{ total_completion_percentage }} -->
        </h3>

        <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:{{ total_completion_percentage }}%">
                {{ total_completion_percentage }}% Complete
            </div>
        </div>
    </div>
    <div id="edit_profile"></div>
{% endblock %}